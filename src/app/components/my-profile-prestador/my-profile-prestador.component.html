<div class="container bg-body-tertiary">
    <header>
        <h1 class="text-center">Soy el prestador N° {{ prestadorId }} </h1>
        <div id="alert"></div>
    </header>
    <div *ngIf="loading">
        <div class="d-flex justify-content-center align-items-center">
            <div class="spinner-border text-warning" style="width: 4rem; height: 4rem; margin: 5rem ;"
                aria-hidden="true">
            </div>
        </div>
    </div>
    <section>
        <div class="accordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMisTrabajos">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseMisTrabajos" aria-expanded="false" aria-controls="collapseMisTrabajos">
                        <h2>Mis trabajos</h2>
                    </button>
                </h2>
                <div id="collapseMisTrabajos" class="accordion-collapse collapse" aria-labelledby="headingMisTrabajos"
                    data-bs-parent=".accordion">
                    <div class="accordion-body">
                        <div id="trabajos">
                            <button class="btn btn-warning" routerLink="/trabajos">Buscar&nbsp;trabajos&nbsp;disponibles
                            </button>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">N°</th>
                                            <th scope="col">Nombre</th>
                                            <th scope="col">Fecha</th>
                                            <th scope="col">Lugar</th>
                                            <th scope="col">Estado</th>
                                            <th scope="col">Ver</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of listaTrabajos.reverse(); let i = index">
                                            <th scope="row" class="align-middle col-1">{{i+1}}</th>
                                            <td class="align-middle col-2">{{item.nombre}}</td>
                                            <td class="align-middle col-2">{{item.fecha.substring(0,10)}}</td>
                                            <td class="align-middle col-2">{{item.lugar}}</td>
                                            <td class="align-middle col-2">
                                                <span title="{{item.estado}}">{{item.estado.nombre}}</span>
                                            </td>
                                            <td class="align-middle col-1 ">
                                                <btn class="btn btn-outline-warning btn-sm text-dark"
                                                    routerLink="/trabajo/{{item.id}}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                        fill="currentColor" class="bi bi-box-arrow-in-right"
                                                        viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd"
                                                            d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z" />
                                                        <path fill-rule="evenodd"
                                                            d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
                                                    </svg>
                                                </btn>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <br>
    <section>
        <div class="accordion" id="accordionMensajes">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMensajes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseMensajes" aria-expanded="false" aria-controls="collapseMensajes">
                        <h2>Mensajes recibidos</h2>
                    </button>
                </h2>
                <div id="collapseMensajes" class="accordion-collapse collapse" aria-labelledby="headingMensajes"
                    data-bs-parent="#accordionMensajes">
                    <div class="accordion-body">
                        <div id="mensajesRecibidos">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">N°</th>
                                            <th scope="col">Asunto</th>
                                            <th scope="col">Mensaje</th>
                                            <th scope="col">Fecha</th>
                                            <th scope="col">Cliente</th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of mensajesRecibidos.reverse(); let i = index">
                                            <th scope="row" class="align-middle col-1">{{i+1}}</th>
                                            <td class="align-middle col-1">{{item.asunto}}</td>
                                            <td class="align-middle col-5">{{item.mensaje}}</td>
                                            <td class="align-middle col-2">{{item.createdAt}}</td>
                                            <td class="align-middle col-2">
                                                {{item.consumidor.usuario.nombre.charAt(0).toUpperCase() +
                                                item.consumidor.usuario.nombre.slice(1)}}
                                                {{item.consumidor.usuario.apellido.charAt(0).toUpperCase() +
                                                item.consumidor.usuario.apellido.slice(1)}}</td>
                                            <td class="align-middle col-1 ">
                                                <button class="btn btn-outline-danger btn-sm me-1" (click)="borrarMensajeRecibido(item.id)">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                                                        <path
                                                            d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                                                    </svg>
                                                </button>
                                                <button class="btn btn-outline-warning btn-sm text-dark" routerLink="/postulate/{{item.consumidor.id}}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                                                        <path
                                                            d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z" />
                                                    </svg>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <br>
    <section>
        <div class="accordion" id="accordionMensajesEnviados">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMensajesEnviados">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseMensajesEnviados" aria-expanded="false"
                        aria-controls="collapseMensajesEnviados">
                        <h2>Mensajes enviados</h2>
                    </button>
                </h2>
                <div id="collapseMensajesEnviados" class="accordion-collapse collapse"
                    aria-labelledby="headingMensajesEnviados" data-bs-parent="#accordionMensajesEnviados">
                    <div class="accordion-body">
                        <div id="mensajesEnviados">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">N°</th>
                                            <th scope="col">Asunto</th>
                                            <th scope="col">Mensaje</th>
                                            <th scope="col">Fecha</th>
                                            <th scope="col">Cliente</th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of mensajesEnviados.reverse(); let i = index">
                                            <th scope="row" class="align-middle col-1">{{i+1}}</th>
                                            <td class="align-middle col-1">{{item.asunto}}</td>
                                            <td class="align-middle col-5">{{item.mensaje}}</td>
                                            <td class="align-middle col-2">{{item.createdAt}}</td>
                                            <td class="align-middle col-2">
                                                {{item.consumidor.usuario.nombre.charAt(0).toUpperCase() +
                                                item.consumidor.usuario.nombre.slice(1)}}
                                                {{item.consumidor.usuario.apellido.charAt(0).toUpperCase() +
                                                item.consumidor.usuario.apellido.slice(1)}}</td>
                                            <td class="align-middle col-1 ">
                                                <button class="btn btn-outline-danger btn-sm me-1" (click)="borrarMensajeEnviado(item.id)">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                                                        <path
                                                            d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                                                    </svg>
                                                </button>
                                                <button class="btn btn-outline-warning btn-sm text-dark" routerLink="/postulate/{{item.consumidor.id}}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                                                        <path
                                                            d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z" />
                                                    </svg>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <br>
    <section *ngIf="!loading">
        <div class="accordion" id="accordionCuentaPrestador">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingCuentaPrestador">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseCuentaPrestador" aria-expanded="true"
                        aria-controls="collapseCuentaMetodoPago">
                        <h2>Cuenta</h2>
                    </button>
                </h2>
                <div id="collapseCuentaPrestador" class="accordion-collapse collapse"
                    aria-labelledby="headingCuentaPrestador" data-bs-parent="#accordionCuentaPrestador">
                    <div class="accordion-body">
                        <form [formGroup]="cuentaForm">
                            <div>
                                <label for="cuilCuit" class="form-label">CUIL/CUIT</label>
                                <input readonly type="text" class="form-control" id="cuilCuit" name="cuilCuit"
                                    value="{{prestador.cuilCuit}}" formControlName="cuilCuit" [ngClass]="{ 'is-invalid': cuentaForm.get('cuilCuit')?.touched }">
                            </div>
                            <div class="text-danger" formControlName="cuilCuit" *ngIf="cuentaForm.get('cuilCuit')?.touched">
                                <li>Este campo no se puede modificar</li>
                            </div>
                            <div>
                                <label for="descripcion" class="form-label mt-3">Descripción del Prestador</label>
                                <textarea class="form-control" id="descripcion" rows="3" name="descripcion"
                                    placeholder="Ingrese la descripción del prestador" formControlName="descripcion"
                                    [ngClass]="{ 'is-invalid': cuentaForm.get('descripcion')?.errors &&  cuentaForm.get('descripcion')?.touched  }">
                                    {{prestador.descripcion}}
                                </textarea>
                            </div>
                            <div class="text-danger" formControlName="descripcion" *ngIf=" cuentaForm.get('descripcion')?.errors && cuentaForm.get('descripcion')?.touched">
                                <li>Este campo es requerido</li>
                            </div>
                            <div>
                                <label for="fotosTrabajos" class="form-label mt-3">Fotos de Trabajos Realizados</label>
                                <input type="text" class="form-control" id="fotosTrabajos" name="fotosTrabajos"
                                    value="{{prestador.fotosTrabajosRealizados}}"
                                    formControlName="fotosTrabajosRealizados" [ngClass]="{ 'is-invalid': cuentaForm.get('fotosTrabajosRealizados')?.errors &&  cuentaForm.get('fotosTrabajosRealizados')?.touched  }">
                            </div>
                            <div class="text-danger" formControlName="fotosTrabajosRealizados" *ngIf=" cuentaForm.get('fotosTrabajosRealizados')?.errors && cuentaForm.get('fotosTrabajosRealizados')?.touched">
                                <li>Este campo es requerido</li>
                            </div>
                            <div>
                                <label for="horariosAtencion" class="form-label mt-3">Horarios de Atención</label>
                                <input type="text" class="form-control" id="horariosAtencion" name="horariosAtencion"
                                    placeholder="Ingrese los horarios de atención"
                                    value="{{prestador.horariosAtencion}}" formControlName="horariosAtencion" [ngClass]="{ 'is-invalid': cuentaForm.get('horariosAtencion')?.touched }">
                            </div>
                            <div class="text-danger" formControlName="horariosAtencion" *ngIf=" cuentaForm.get('horariosAtencion')?.errors && cuentaForm.get('horariosAtencion')?.touched">
                                <li>Este campo es requerido</li>
                            </div>
                            <div>
                                <label for="disponibilidad" class="form-label mt-3">Disponibilidad</label>
                                <select class="form-select" id="disponibilidad" name="disponibilidad"
                                    formControlName="disponibilidad">
                                    <option selected value="{{prestador.disponibilidad}}">{{prestador.disponibilidad ?
                                        'Disponible' : 'No disponible'}}</option>
                                    <option *ngIf="!prestador.disponibilidad" value="true">Disponible</option>
                                    <option *ngIf="prestador.disponibilidad" value="false">No disponible</option>
                                </select>
                            </div>
                            <div>
                                <label for="radioCobertura" class="form-label mt-3">Radio de Cobertura</label>
                                <input type="text" class="form-control" id="radioCobertura" name="radioCobertura"
                                    placeholder="Ingrese el radio de cobertura" value="{{prestador.radioCobertura}}"
                                    formControlName="radioCobertura" [ngClass]="{ 'is-invalid': cuentaForm.get('radioCobertura')?.touched }">
                            </div>
                            <div class="text-danger" formControlName="radioCobertura" *ngIf=" cuentaForm.get('radioCobertura')?.errors && cuentaForm.get('radioCobertura')?.touched">
                                <li>Este campo es requerido</li>
                            </div>
                            <button type="submit" class="btn btn-warning mt-3" (click)="guardarCuenta()"
                                [disabled]="!cuentaForm.valid">Guardar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>